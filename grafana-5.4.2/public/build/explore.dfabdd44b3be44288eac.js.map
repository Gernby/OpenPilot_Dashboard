{"version":3,"sources":["webpack:///./public/app/features/explore/ErrorBoundary.tsx","webpack:///./public/app/features/explore/Legend.tsx","webpack:///./public/app/features/explore/Graph.tsx","webpack:///./public/app/features/explore/Explore.tsx","webpack:///./public/app/features/explore/Panel.tsx","webpack:///./public/app/features/explore/Table.tsx","webpack:///./public/app/features/explore/TimePicker.tsx","webpack:///./public/app/features/explore/utils/query.ts","webpack:///./public/app/features/explore/ElapsedTime.tsx","webpack:///./public/app/features/explore/QueryTransactionStatus.tsx","webpack:///./public/app/features/explore/QueryRows.tsx","webpack:///./public/app/core/utils/text.ts","webpack:///./public/app/features/explore/Logs.tsx","webpack:///./public/app/features/explore/Wrapper.tsx"],"names":["ErrorBoundary","_super","props","_this","call","this","state","error","errorInfo","tslib__WEBPACK_IMPORTED_MODULE_0__","prototype","componentDidCatch","setState","render","react__WEBPACK_IMPORTED_MODULE_1___default","a","createElement","className","style","whiteSpace","toString","componentStack","children","react__WEBPACK_IMPORTED_MODULE_1__","LegendItem","_a","series","react_default","color","title","alias","Legend","tslib_es6","_b","items","data","map","key","id","react","FLOT_OPTIONS","legend","show","lines","linewidth","zero","shadowSize","grid","minBorderMargin","markings","backgroundColor","borderWidth","clickable","margin","left","right","labelMarginX","selection","mode","Graph_Graph","Graph","apply","arguments","showAllTimeSeries","onPlotSelected","event","ranges","onChangeTime","range","from","moment_default","xaxis","to","onShowAllTimeSeries","draw","getGraphData","slice","componentDidMount","$el","jquery_js_exposed_default","bind","componentDidUpdate","prevProps","split","height","size","width","componentWillUnmount","unbind","userOptions","length","ts","label","getFlotPairs","ticks","isMoment","datemath","min","valueOf","max","dynamicOptions","timezone","timeformat","secPerTick","time_format","options","plot","_c","Fragment","onClick","explore_Legend","__webpack_exports__","Object","react_sizeme","MAX_HISTORY_ITEMS","getIntervals","datasource","resolution","interval","intervalMs","absoluteRange","app_core_utils_datemath__WEBPACK_IMPORTED_MODULE_9__","app_core_utils_kbn__WEBPACK_IMPORTED_MODULE_5__","calculateInterval","Explore","getRef","el","onAddQueryRow","index","queryExpressions","queries","queryTransactions","concat","query","_utils_query__WEBPACK_IMPORTED_MODULE_23__","qt","rowIndex","onChangeDatasource","option","origin","datasourceError","datasourceLoading","datasourceName","value","datasourceSrv","get","sent","setDatasource","onChangeQuery","override","nextQuery","nextQueries","filter","onSubmit","nextRange","onClickClear","prevState","showingStartPage","Boolean","StartPage","saveState","onClickCloseSplit","onChangeSplit","onClickGraphButton","showingGraph","nextQueryTransactions","resultType","onClickLogsButton","showingLogs","onClickQuery","q","onClickSplit","cloneState","onClickTableButton","showingTable","onClickTableCell","columnKey","rowValue","onModifyQueries","type","action","modifyQuery","preventSubmit_1","preventSubmit","undefined","i","hints","hint","fix","onRemoveQueryRow","supportsGraph","supportsLogs","supportsTable","runTableQuery","runGraphQueries","runLogsQuery","stateKey","onSaveState","initialQueries","splitState","urlState","initialRange","app_core_utils_explore__WEBPACK_IMPORTED_MODULE_10__","datasourceMissing","exploreDatasources","graphRange","history","Error","datasources","getExploreSources","ds","name","meta","explore","metrics","logs","datasourceId","requestedDatasourceId","testDatasource","testResult","status","message","error_1","statusText","historyKey","app_core_store__WEBPACK_IMPORTED_MODULE_7__","getObject","init","importQueries","wrappedQueries","refId","String","expr","modifiedQueries","pluginExports","ExploreStartPage","buildQueryOptions","targetOptions","offsetWidth","targets","startQueryTransaction","queryOptions","transaction","done","latency","completeQueryTransaction","transactionId","result","find","getQueryHints","Date","now","forEach","setObject","updateHistory","discardTransactions","failQueryTransaction","response","console","format","instant","res","results","dataList","seriesData","datapoints","target","colorIndex","app_core_utils_colors__WEBPACK_IMPORTED_MODULE_6__","app_core_time_series2__WEBPACK_IMPORTED_MODULE_8__","unit","makeTimeSeriesList","response_1","valueWithRefId","response_2","response_3","position","graphHeight","exploreClass","selectedDatasource","d","graphRangeIntervals","graphLoading","some","tableLoading","logsLoading","graphResult","lodash__WEBPACK_IMPORTED_MODULE_4___default","flatten","tableResult","app_core_table_model__WEBPACK_IMPORTED_MODULE_15__","logsResult","mergeStreams","loading","ref","react_select__WEBPACK_IMPORTED_MODULE_3__","classNamePrefix","isMulti","isLoading","isClearable","onChange","styles","app_core_components_Picker_ResetStyles__WEBPACK_IMPORTED_MODULE_11__","placeholder","loadingMessage","noOptionsMessage","components","Option","app_core_components_Picker_PickerOption__WEBPACK_IMPORTED_MODULE_12__","IndicatorsContainer","app_core_components_Picker_IndicatorsContainer__WEBPACK_IMPORTED_MODULE_13__","NoOptionsMessage","app_core_components_Picker_NoOptionsMessage__WEBPACK_IMPORTED_MODULE_14__","_TimePicker__WEBPACK_IMPORTED_MODULE_22__","_QueryRows__WEBPACK_IMPORTED_MODULE_17__","onClickHintFix","onExecuteQuery","transactions","_ErrorBoundary__WEBPACK_IMPORTED_MODULE_21__","_Panel__WEBPACK_IMPORTED_MODULE_16__","isOpen","onToggle","_Graph__WEBPACK_IMPORTED_MODULE_18__","_Table__WEBPACK_IMPORTED_MODULE_20__","onClickCell","_Logs__WEBPACK_IMPORTED_MODULE_19__","PureComponent","react_hot_loader__WEBPACK_IMPORTED_MODULE_2__","module","Panel","onClickToggle","iconClass","loaderClass","EMPTY_TABLE","VALUE_REGEX","Table","getCellProps","rowInfo","column","e","Header","row","tableModel","columnNames","columns","text","filterable","accessor","test","Cell","react__WEBPACK_IMPORTED_MODULE_2___default","noDataText","react_table__WEBPACK_IMPORTED_MODULE_3__","rows","getTdProps","minRows","resolveData","cells","lodash__WEBPACK_IMPORTED_MODULE_1___default","zipObject","prepareRows","showPagination","react__WEBPACK_IMPORTED_MODULE_2__","DATE_FORMAT","DEFAULT_RANGE","parseTime","isUtc","moment__WEBPACK_IMPORTED_MODULE_2___default","indexOf","time","isNaN","parseInt","utc","TimePicker","handleChangeFrom","fromRaw","handleChangeTo","toRaw","handleClickApply","app_core_utils_datemath__WEBPACK_IMPORTED_MODULE_3__","rangeString","app_core_utils_rangeutil__WEBPACK_IMPORTED_MODULE_4__","handleClickLeft","move","handleClickPicker","handleClickRight","handleClickRefresh","handleClickRelativeOption","dropdownRef","dropdownEl","refreshInterval","getDerivedStateFromProps","direction","nextTo","nextFrom","timespan","getTimeOptions","renderDropdown","timeOptions","keys","section","group","active","display","generateQueryKey","Math","random","ensureQueries","hasQuery","__webpack_require__","ElapsedTime","elapsed","tick","offset","start","timer","window","setInterval","componentWillReceiveProps","nextProps","clearInterval","toFixed","QueryTransactionStatus_QueryTransactionStatusItem","QueryTransactionStatusItem","formatLatency","explore_ElapsedTime","QueryTransactionStatus","t","QueryRows_QueryRow","QueryRow","onClickAddButton","onClickClearButton","onClickRemoveButton","onPressEnter","transactionWithError","getFirstHintFromTransactions","queryError","QueryField","ExploreQueryField","explore_QueryField","explore_QueryTransactionStatus","initialQuery","onQueryChange","QueryRows_QueryRows","QueryRows","handlers","findHighlightChunksInText","searchWords","haystack","needle","regexp","RegExp","matches","match","exec","push","end","findMatchesInText","textToHighlight","join","graphOptions","bars","lineWidth","yaxis","tickDecimals","Logs_Logs","Logs","dedup","logs_model","none","showLabels","showLocalTime","showUtc","onChangeDedup","onChangeLabels","checked","onChangeLocalTime","onChangeUtc","_d","hasData","dedupedData","dedupCount","reduce","sum","duplicates","cssColumnSizes","logEntriesStyle","gridTemplateColumns","Switch","small","exact","numbers","signature","item","logLevel","Array","timeLocal","timeFromNow","timestamp","labels","main_default","entry","findChunks","highlightClassName","STATE_KEY_RIGHT","Wrapper","urlStates","updateLocation","app_core_utils_explore__WEBPACK_IMPORTED_MODULE_5__","urlStateLeft","urlStateRight","_ErrorBoundary__WEBPACK_IMPORTED_MODULE_6__","_Explore__WEBPACK_IMPORTED_MODULE_7__","mapDispatchToProps","app_core_actions__WEBPACK_IMPORTED_MODULE_4__","react_redux__WEBPACK_IMPORTED_MODULE_3__","location"],"mappings":"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","file":"explore.dfabdd44b3be44288eac.js","sourcesContent":["import React, { Component } from 'react';\n\nexport default class ErrorBoundary extends Component<{}, any> {\n  constructor(props) {\n    super(props);\n    this.state = { error: null, errorInfo: null };\n  }\n\n  componentDidCatch(error, errorInfo) {\n    // Catch errors in any components below and re-render with error message\n    this.setState({\n      error: error,\n      errorInfo: errorInfo,\n    });\n  }\n\n  render() {\n    if (this.state.errorInfo) {\n      // Error path\n      return (\n        <div className=\"explore-container\">\n          <h3>An unexpected error happened.</h3>\n          <details style={{ whiteSpace: 'pre-wrap' }}>\n            {this.state.error && this.state.error.toString()}\n            <br />\n            {this.state.errorInfo.componentStack}\n          </details>\n        </div>\n      );\n    }\n    // Normally, just render children\n    return this.props.children;\n  }\n}\n","import React, { PureComponent } from 'react';\n\nconst LegendItem = ({ series }) => (\n  <div className=\"graph-legend-series\">\n    <div className=\"graph-legend-icon\">\n      <i className=\"fa fa-minus pointer\" style={{ color: series.color }} />\n    </div>\n    <a className=\"graph-legend-alias pointer\" title={series.alias}>\n      {series.alias}\n    </a>\n  </div>\n);\n\nexport default class Legend extends PureComponent<any, any> {\n  render() {\n    const { className = '', data } = this.props;\n    const items = data || [];\n    return (\n      <div className={`${className} graph-legend ps`}>\n        {items.map(series => <LegendItem key={series.id} series={series} />)}\n      </div>\n    );\n  }\n}\n","import $ from 'jquery';\nimport React, { PureComponent } from 'react';\nimport moment from 'moment';\nimport { withSize } from 'react-sizeme';\n\nimport 'vendor/flot/jquery.flot';\nimport 'vendor/flot/jquery.flot.time';\nimport 'vendor/flot/jquery.flot.selection';\nimport 'vendor/flot/jquery.flot.stack';\n\nimport { RawTimeRange } from 'app/types/series';\nimport * as dateMath from 'app/core/utils/datemath';\nimport TimeSeries from 'app/core/time_series2';\n\nimport Legend from './Legend';\n\nconst MAX_NUMBER_OF_TIME_SERIES = 20;\n\n// Copied from graph.ts\nfunction time_format(ticks, min, max) {\n  if (min && max && ticks) {\n    const range = max - min;\n    const secPerTick = range / ticks / 1000;\n    const oneDay = 86400000;\n    const oneYear = 31536000000;\n\n    if (secPerTick <= 45) {\n      return '%H:%M:%S';\n    }\n    if (secPerTick <= 7200 || range <= oneDay) {\n      return '%H:%M';\n    }\n    if (secPerTick <= 80000) {\n      return '%m/%d %H:%M';\n    }\n    if (secPerTick <= 2419200 || range <= oneYear) {\n      return '%m/%d';\n    }\n    return '%Y-%m';\n  }\n\n  return '%H:%M';\n}\n\nconst FLOT_OPTIONS = {\n  legend: {\n    show: false,\n  },\n  series: {\n    lines: {\n      linewidth: 1,\n      zero: false,\n    },\n    shadowSize: 0,\n  },\n  grid: {\n    minBorderMargin: 0,\n    markings: [],\n    backgroundColor: null,\n    borderWidth: 0,\n    // hoverable: true,\n    clickable: true,\n    color: '#a1a1a1',\n    margin: { left: 0, right: 0 },\n    labelMarginX: 0,\n  },\n  selection: {\n    mode: 'x',\n    color: '#666',\n  },\n  // crosshair: {\n  //   mode: 'x',\n  // },\n};\n\ninterface GraphProps {\n  data: any[];\n  height?: string; // e.g., '200px'\n  id?: string;\n  range: RawTimeRange;\n  split?: boolean;\n  size?: { width: number; height: number };\n  userOptions?: any;\n  onChangeTime?: (range: RawTimeRange) => void;\n}\n\ninterface GraphState {\n  showAllTimeSeries: boolean;\n}\n\nexport class Graph extends PureComponent<GraphProps, GraphState> {\n  $el: any;\n\n  state = {\n    showAllTimeSeries: false,\n  };\n\n  getGraphData() {\n    const { data } = this.props;\n\n    return this.state.showAllTimeSeries ? data : data.slice(0, MAX_NUMBER_OF_TIME_SERIES);\n  }\n\n  componentDidMount() {\n    this.draw();\n    this.$el = $(`#${this.props.id}`);\n    this.$el.bind('plotselected', this.onPlotSelected);\n  }\n\n  componentDidUpdate(prevProps: GraphProps) {\n    if (\n      prevProps.data !== this.props.data ||\n      prevProps.range !== this.props.range ||\n      prevProps.split !== this.props.split ||\n      prevProps.height !== this.props.height ||\n      (prevProps.size && prevProps.size.width !== this.props.size.width)\n    ) {\n      this.draw();\n    }\n  }\n\n  componentWillUnmount() {\n    this.$el.unbind('plotselected', this.onPlotSelected);\n  }\n\n  onPlotSelected = (event, ranges) => {\n    if (this.props.onChangeTime) {\n      const range = {\n        from: moment(ranges.xaxis.from),\n        to: moment(ranges.xaxis.to),\n      };\n      this.props.onChangeTime(range);\n    }\n  };\n\n  onShowAllTimeSeries = () => {\n    this.setState(\n      {\n        showAllTimeSeries: true,\n      },\n      this.draw\n    );\n  };\n\n  draw() {\n    const { range, size, userOptions = {} } = this.props;\n    const data = this.getGraphData();\n\n    const $el = $(`#${this.props.id}`);\n    let series = [{ data: [[0, 0]] }];\n\n    if (data && data.length > 0) {\n      series = data.map((ts: TimeSeries) => ({\n        color: ts.color,\n        label: ts.label,\n        data: ts.getFlotPairs('null'),\n      }));\n    }\n\n    const ticks = (size.width || 0) / 100;\n    let { from, to } = range;\n    if (!moment.isMoment(from)) {\n      from = dateMath.parse(from, false);\n    }\n    if (!moment.isMoment(to)) {\n      to = dateMath.parse(to, true);\n    }\n    const min = from.valueOf();\n    const max = to.valueOf();\n    const dynamicOptions = {\n      xaxis: {\n        mode: 'time',\n        min: min,\n        max: max,\n        label: 'Datetime',\n        ticks: ticks,\n        timezone: 'browser',\n        timeformat: time_format(ticks, min, max),\n      },\n    };\n    const options = {\n      ...FLOT_OPTIONS,\n      ...dynamicOptions,\n      ...userOptions,\n    };\n    $.plot($el, series, options);\n  }\n\n  render() {\n    const { height = '100px', id = 'graph' } = this.props;\n    const data = this.getGraphData();\n\n    return (\n      <>\n        {this.props.data &&\n          this.props.data.length > MAX_NUMBER_OF_TIME_SERIES &&\n          !this.state.showAllTimeSeries && (\n            <div className=\"time-series-disclaimer\">\n              <i className=\"fa fa-fw fa-warning disclaimer-icon\" />\n              {`Showing only ${MAX_NUMBER_OF_TIME_SERIES} time series. `}\n              <span className=\"show-all-time-series\" onClick={this.onShowAllTimeSeries}>{`Show all ${\n                this.props.data.length\n              }`}</span>\n            </div>\n          )}\n        <div id={id} className=\"explore-graph\" style={{ height }} />\n        <Legend data={data} />\n      </>\n    );\n  }\n}\n\nexport default withSize()(Graph);\n","import React from 'react';\nimport { hot } from 'react-hot-loader';\nimport Select from 'react-select';\nimport _ from 'lodash';\n\nimport { DataSource } from 'app/types/datasources';\nimport { ExploreState, ExploreUrlState, HistoryItem, Query, QueryTransaction, ResultType } from 'app/types/explore';\nimport { RawTimeRange, DataQuery } from 'app/types/series';\nimport kbn from 'app/core/utils/kbn';\nimport colors from 'app/core/utils/colors';\nimport store from 'app/core/store';\nimport TimeSeries from 'app/core/time_series2';\nimport { parse as parseDate } from 'app/core/utils/datemath';\nimport { DEFAULT_RANGE } from 'app/core/utils/explore';\nimport ResetStyles from 'app/core/components/Picker/ResetStyles';\nimport PickerOption from 'app/core/components/Picker/PickerOption';\nimport IndicatorsContainer from 'app/core/components/Picker/IndicatorsContainer';\nimport NoOptionsMessage from 'app/core/components/Picker/NoOptionsMessage';\nimport TableModel, { mergeTablesIntoModel } from 'app/core/table_model';\nimport { DatasourceSrv } from 'app/features/plugins/datasource_srv';\n\nimport Panel from './Panel';\nimport QueryRows from './QueryRows';\nimport Graph from './Graph';\nimport Logs from './Logs';\nimport Table from './Table';\nimport ErrorBoundary from './ErrorBoundary';\nimport TimePicker from './TimePicker';\nimport { ensureQueries, generateQueryKey, hasQuery } from './utils/query';\n\nconst MAX_HISTORY_ITEMS = 100;\n\nfunction getIntervals(range: RawTimeRange, datasource, resolution: number): { interval: string; intervalMs: number } {\n  if (!datasource || !resolution) {\n    return { interval: '1s', intervalMs: 1000 };\n  }\n  const absoluteRange: RawTimeRange = {\n    from: parseDate(range.from, false),\n    to: parseDate(range.to, true),\n  };\n  return kbn.calculateInterval(absoluteRange, resolution, datasource.interval);\n}\n\nfunction makeTimeSeriesList(dataList, options) {\n  return dataList.map((seriesData, index) => {\n    const datapoints = seriesData.datapoints || [];\n    const alias = seriesData.target;\n    const colorIndex = index % colors.length;\n    const color = colors[colorIndex];\n\n    const series = new TimeSeries({\n      datapoints,\n      alias,\n      color,\n      unit: seriesData.unit,\n    });\n\n    return series;\n  });\n}\n\n/**\n * Update the query history. Side-effect: store history in local storage\n */\nfunction updateHistory(history: HistoryItem[], datasourceId: string, queries: string[]): HistoryItem[] {\n  const ts = Date.now();\n  queries.forEach(query => {\n    history = [{ query, ts }, ...history];\n  });\n\n  if (history.length > MAX_HISTORY_ITEMS) {\n    history = history.slice(0, MAX_HISTORY_ITEMS);\n  }\n\n  // Combine all queries of a datasource type into one history\n  const historyKey = `grafana.explore.history.${datasourceId}`;\n  store.setObject(historyKey, history);\n  return history;\n}\n\ninterface ExploreProps {\n  datasourceSrv: DatasourceSrv;\n  onChangeSplit: (split: boolean, state?: ExploreState) => void;\n  onSaveState: (key: string, state: ExploreState) => void;\n  position: string;\n  split: boolean;\n  splitState?: ExploreState;\n  stateKey: string;\n  urlState: ExploreUrlState;\n}\n\nexport class Explore extends React.PureComponent<ExploreProps, ExploreState> {\n  el: any;\n  /**\n   * Current query expressions of the rows including their modifications, used for running queries.\n   * Not kept in component state to prevent edit-render roundtrips.\n   * TODO: make this generic (other datasources might not have string representations of current query state)\n   */\n  queryExpressions: string[];\n  /**\n   * Local ID cache to compare requested vs selected datasource\n   */\n  requestedDatasourceId: string;\n\n  constructor(props) {\n    super(props);\n    const splitState: ExploreState = props.splitState;\n    let initialQueries: Query[];\n    if (splitState) {\n      // Split state overrides everything\n      this.state = splitState;\n      initialQueries = splitState.queries;\n    } else {\n      const { datasource, queries, range } = props.urlState as ExploreUrlState;\n      initialQueries = ensureQueries(queries);\n      const initialRange = range || { ...DEFAULT_RANGE };\n      this.state = {\n        datasource: null,\n        datasourceError: null,\n        datasourceLoading: null,\n        datasourceMissing: false,\n        datasourceName: datasource,\n        exploreDatasources: [],\n        graphRange: initialRange,\n        history: [],\n        queries: initialQueries,\n        queryTransactions: [],\n        range: initialRange,\n        showingGraph: true,\n        showingLogs: true,\n        showingStartPage: false,\n        showingTable: true,\n        supportsGraph: null,\n        supportsLogs: null,\n        supportsTable: null,\n      };\n    }\n    this.queryExpressions = initialQueries.map(q => q.query);\n  }\n\n  async componentDidMount() {\n    const { datasourceSrv } = this.props;\n    const { datasourceName } = this.state;\n    if (!datasourceSrv) {\n      throw new Error('No datasource service passed as props.');\n    }\n    const datasources = datasourceSrv.getExploreSources();\n    const exploreDatasources = datasources.map(ds => ({\n      value: ds.name,\n      label: ds.name,\n    }));\n\n    if (datasources.length > 0) {\n      this.setState({ datasourceLoading: true, exploreDatasources });\n      // Priority: datasource in url, default datasource, first explore datasource\n      let datasource;\n      if (datasourceName) {\n        datasource = await datasourceSrv.get(datasourceName);\n      } else {\n        datasource = await datasourceSrv.get();\n      }\n      if (!datasource.meta.explore) {\n        datasource = await datasourceSrv.get(datasources[0].name);\n      }\n      await this.setDatasource(datasource);\n    } else {\n      this.setState({ datasourceMissing: true });\n    }\n  }\n\n  async setDatasource(datasource: any, origin?: DataSource) {\n    const supportsGraph = datasource.meta.metrics;\n    const supportsLogs = datasource.meta.logs;\n    const supportsTable = datasource.meta.metrics;\n    const datasourceId = datasource.meta.id;\n    let datasourceError = null;\n\n    // Keep ID to track selection\n    this.requestedDatasourceId = datasourceId;\n\n    try {\n      const testResult = await datasource.testDatasource();\n      datasourceError = testResult.status === 'success' ? null : testResult.message;\n    } catch (error) {\n      datasourceError = (error && error.statusText) || 'Network error';\n    }\n\n    if (datasourceId !== this.requestedDatasourceId) {\n      // User already changed datasource again, discard results\n      return;\n    }\n\n    const historyKey = `grafana.explore.history.${datasourceId}`;\n    const history = store.getObject(historyKey, []);\n\n    if (datasource.init) {\n      datasource.init();\n    }\n\n    // Check if queries can be imported from previously selected datasource\n    let queryExpressions = this.queryExpressions;\n    if (origin) {\n      if (origin.meta.id === datasource.meta.id) {\n        // Keep same queries if same type of datasource\n        queryExpressions = [...this.queryExpressions];\n      } else if (datasource.importQueries) {\n        // Datasource-specific importers, wrapping to satisfy interface\n        const wrappedQueries: DataQuery[] = this.queryExpressions.map((query, index) => ({\n          refId: String(index),\n          expr: query,\n        }));\n        const modifiedQueries: DataQuery[] = await datasource.importQueries(wrappedQueries, origin.meta);\n        queryExpressions = modifiedQueries.map(({ expr }) => expr);\n      } else {\n        // Default is blank queries\n        queryExpressions = this.queryExpressions.map(() => '');\n      }\n    }\n\n    // Reset edit state with new queries\n    const nextQueries = this.state.queries.map((q, i) => ({\n      ...q,\n      key: generateQueryKey(i),\n      query: queryExpressions[i],\n    }));\n    this.queryExpressions = queryExpressions;\n\n    // Custom components\n    const StartPage = datasource.pluginExports.ExploreStartPage;\n\n    this.setState(\n      {\n        StartPage,\n        datasource,\n        datasourceError,\n        history,\n        supportsGraph,\n        supportsLogs,\n        supportsTable,\n        datasourceLoading: false,\n        datasourceName: datasource.name,\n        queries: nextQueries,\n        showingStartPage: Boolean(StartPage),\n      },\n      () => {\n        if (datasourceError === null) {\n          this.onSubmit();\n        }\n      }\n    );\n  }\n\n  getRef = el => {\n    this.el = el;\n  };\n\n  onAddQueryRow = index => {\n    // Local cache\n    this.queryExpressions[index + 1] = '';\n\n    this.setState(state => {\n      const { queries, queryTransactions } = state;\n\n      // Add row by generating new react key\n      const nextQueries = [\n        ...queries.slice(0, index + 1),\n        { query: '', key: generateQueryKey() },\n        ...queries.slice(index + 1),\n      ];\n\n      // Ongoing transactions need to update their row indices\n      const nextQueryTransactions = queryTransactions.map(qt => {\n        if (qt.rowIndex > index) {\n          return {\n            ...qt,\n            rowIndex: qt.rowIndex + 1,\n          };\n        }\n        return qt;\n      });\n\n      return { queries: nextQueries, queryTransactions: nextQueryTransactions };\n    });\n  };\n\n  onChangeDatasource = async option => {\n    const origin = this.state.datasource;\n    this.setState({\n      datasource: null,\n      datasourceError: null,\n      datasourceLoading: true,\n      queryTransactions: [],\n    });\n    const datasourceName = option.value;\n    const datasource = await this.props.datasourceSrv.get(datasourceName);\n    this.setDatasource(datasource as any, origin);\n  };\n\n  onChangeQuery = (value: string, index: number, override?: boolean) => {\n    // Keep current value in local cache\n    this.queryExpressions[index] = value;\n\n    if (override) {\n      this.setState(state => {\n        // Replace query row\n        const { queries, queryTransactions } = state;\n        const nextQuery: Query = {\n          key: generateQueryKey(index),\n          query: value,\n        };\n        const nextQueries = [...queries];\n        nextQueries[index] = nextQuery;\n\n        // Discard ongoing transaction related to row query\n        const nextQueryTransactions = queryTransactions.filter(qt => qt.rowIndex !== index);\n\n        return {\n          queries: nextQueries,\n          queryTransactions: nextQueryTransactions,\n        };\n      }, this.onSubmit);\n    }\n  };\n\n  onChangeTime = (nextRange: RawTimeRange) => {\n    const range: RawTimeRange = {\n      ...nextRange,\n    };\n    this.setState({ range }, () => this.onSubmit());\n  };\n\n  onClickClear = () => {\n    this.queryExpressions = [''];\n    this.setState(\n      prevState => ({\n        queries: ensureQueries(),\n        queryTransactions: [],\n        showingStartPage: Boolean(prevState.StartPage),\n      }),\n      this.saveState\n    );\n  };\n\n  onClickCloseSplit = () => {\n    const { onChangeSplit } = this.props;\n    if (onChangeSplit) {\n      onChangeSplit(false);\n    }\n  };\n\n  onClickGraphButton = () => {\n    this.setState(\n      state => {\n        const showingGraph = !state.showingGraph;\n        let nextQueryTransactions = state.queryTransactions;\n        if (!showingGraph) {\n          // Discard transactions related to Graph query\n          nextQueryTransactions = state.queryTransactions.filter(qt => qt.resultType !== 'Graph');\n        }\n        return { queryTransactions: nextQueryTransactions, showingGraph };\n      },\n      () => {\n        if (this.state.showingGraph) {\n          this.onSubmit();\n        }\n      }\n    );\n  };\n\n  onClickLogsButton = () => {\n    this.setState(\n      state => {\n        const showingLogs = !state.showingLogs;\n        let nextQueryTransactions = state.queryTransactions;\n        if (!showingLogs) {\n          // Discard transactions related to Logs query\n          nextQueryTransactions = state.queryTransactions.filter(qt => qt.resultType !== 'Logs');\n        }\n        return { queryTransactions: nextQueryTransactions, showingLogs };\n      },\n      () => {\n        if (this.state.showingLogs) {\n          this.onSubmit();\n        }\n      }\n    );\n  };\n\n  // Use this in help pages to set page to a single query\n  onClickQuery = query => {\n    const nextQueries = [{ query, key: generateQueryKey() }];\n    this.queryExpressions = nextQueries.map(q => q.query);\n    this.setState({ queries: nextQueries }, this.onSubmit);\n  };\n\n  onClickSplit = () => {\n    const { onChangeSplit } = this.props;\n    if (onChangeSplit) {\n      const state = this.cloneState();\n      onChangeSplit(true, state);\n    }\n  };\n\n  onClickTableButton = () => {\n    this.setState(\n      state => {\n        const showingTable = !state.showingTable;\n        let nextQueryTransactions = state.queryTransactions;\n        if (!showingTable) {\n          // Discard transactions related to Table query\n          nextQueryTransactions = state.queryTransactions.filter(qt => qt.resultType !== 'Table');\n        }\n        return { queryTransactions: nextQueryTransactions, showingTable };\n      },\n      () => {\n        if (this.state.showingTable) {\n          this.onSubmit();\n        }\n      }\n    );\n  };\n\n  onClickTableCell = (columnKey: string, rowValue: string) => {\n    this.onModifyQueries({ type: 'ADD_FILTER', key: columnKey, value: rowValue });\n  };\n\n  onModifyQueries = (action, index?: number) => {\n    const { datasource } = this.state;\n    if (datasource && datasource.modifyQuery) {\n      const preventSubmit = action.preventSubmit;\n      this.setState(\n        state => {\n          const { queries, queryTransactions } = state;\n          let nextQueries;\n          let nextQueryTransactions;\n          if (index === undefined) {\n            // Modify all queries\n            nextQueries = queries.map((q, i) => ({\n              key: generateQueryKey(i),\n              query: datasource.modifyQuery(this.queryExpressions[i], action),\n            }));\n            // Discard all ongoing transactions\n            nextQueryTransactions = [];\n          } else {\n            // Modify query only at index\n            nextQueries = queries.map((q, i) => {\n              // Synchronise all queries with local query cache to ensure consistency\n              q.query = this.queryExpressions[i];\n              return i === index\n                ? {\n                    key: generateQueryKey(index),\n                    query: datasource.modifyQuery(q.query, action),\n                  }\n                : q;\n            });\n            nextQueryTransactions = queryTransactions\n              // Consume the hint corresponding to the action\n              .map(qt => {\n                if (qt.hints != null && qt.rowIndex === index) {\n                  qt.hints = qt.hints.filter(hint => hint.fix.action !== action);\n                }\n                return qt;\n              })\n              // Preserve previous row query transaction to keep results visible if next query is incomplete\n              .filter(qt => preventSubmit || qt.rowIndex !== index);\n          }\n          this.queryExpressions = nextQueries.map(q => q.query);\n          return {\n            queries: nextQueries,\n            queryTransactions: nextQueryTransactions,\n          };\n        },\n        // Accepting certain fixes do not result in a well-formed query which should not be submitted\n        !preventSubmit ? () => this.onSubmit() : null\n      );\n    }\n  };\n\n  onRemoveQueryRow = index => {\n    // Remove from local cache\n    this.queryExpressions = [...this.queryExpressions.slice(0, index), ...this.queryExpressions.slice(index + 1)];\n\n    this.setState(\n      state => {\n        const { queries, queryTransactions } = state;\n        if (queries.length <= 1) {\n          return null;\n        }\n        // Remove row from react state\n        const nextQueries = [...queries.slice(0, index), ...queries.slice(index + 1)];\n\n        // Discard transactions related to row query\n        const nextQueryTransactions = queryTransactions.filter(qt => qt.rowIndex !== index);\n\n        return {\n          queries: nextQueries,\n          queryTransactions: nextQueryTransactions,\n        };\n      },\n      () => this.onSubmit()\n    );\n  };\n\n  onSubmit = () => {\n    const { showingLogs, showingGraph, showingTable, supportsGraph, supportsLogs, supportsTable } = this.state;\n    if (showingTable && supportsTable) {\n      this.runTableQuery();\n    }\n    if (showingGraph && supportsGraph) {\n      this.runGraphQueries();\n    }\n    if (showingLogs && supportsLogs) {\n      this.runLogsQuery();\n    }\n    this.saveState();\n  };\n\n  buildQueryOptions(\n    query: string,\n    rowIndex: number,\n    targetOptions: { format: string; hinting?: boolean; instant?: boolean }\n  ) {\n    const { datasource, range } = this.state;\n    const { interval, intervalMs } = getIntervals(range, datasource, this.el.offsetWidth);\n    const targets = [\n      {\n        ...targetOptions,\n        // Target identifier is needed for table transformations\n        refId: rowIndex + 1,\n        expr: query,\n      },\n    ];\n\n    // Clone range for query request\n    const queryRange: RawTimeRange = { ...range };\n\n    return {\n      interval,\n      intervalMs,\n      targets,\n      range: queryRange,\n    };\n  }\n\n  startQueryTransaction(query: string, rowIndex: number, resultType: ResultType, options: any): QueryTransaction {\n    const queryOptions = this.buildQueryOptions(query, rowIndex, options);\n    const transaction: QueryTransaction = {\n      query,\n      resultType,\n      rowIndex,\n      id: generateQueryKey(),\n      done: false,\n      latency: 0,\n      options: queryOptions,\n    };\n\n    // Using updater style because we might be modifying queryTransactions in quick succession\n    this.setState(state => {\n      const { queryTransactions } = state;\n      // Discarding existing transactions of same type\n      const remainingTransactions = queryTransactions.filter(\n        qt => !(qt.resultType === resultType && qt.rowIndex === rowIndex)\n      );\n\n      // Append new transaction\n      const nextQueryTransactions = [...remainingTransactions, transaction];\n\n      return {\n        queryTransactions: nextQueryTransactions,\n        showingStartPage: false,\n      };\n    });\n\n    return transaction;\n  }\n\n  completeQueryTransaction(\n    transactionId: string,\n    result: any,\n    latency: number,\n    queries: string[],\n    datasourceId: string\n  ) {\n    const { datasource } = this.state;\n    if (datasource.meta.id !== datasourceId) {\n      // Navigated away, queries did not matter\n      return;\n    }\n\n    this.setState(state => {\n      const { history, queryTransactions } = state;\n\n      // Transaction might have been discarded\n      const transaction = queryTransactions.find(qt => qt.id === transactionId);\n      if (!transaction) {\n        return null;\n      }\n\n      // Get query hints\n      let hints;\n      if (datasource.getQueryHints) {\n        hints = datasource.getQueryHints(transaction.query, result);\n      }\n\n      // Mark transactions as complete\n      const nextQueryTransactions = queryTransactions.map(qt => {\n        if (qt.id === transactionId) {\n          return {\n            ...qt,\n            hints,\n            latency,\n            result,\n            done: true,\n          };\n        }\n        return qt;\n      });\n\n      const nextHistory = updateHistory(history, datasourceId, queries);\n\n      return {\n        history: nextHistory,\n        queryTransactions: nextQueryTransactions,\n      };\n    });\n  }\n\n  discardTransactions(rowIndex: number) {\n    this.setState(state => {\n      const remainingTransactions = state.queryTransactions.filter(qt => qt.rowIndex !== rowIndex);\n      return { queryTransactions: remainingTransactions };\n    });\n  }\n\n  failQueryTransaction(transactionId: string, response: any, datasourceId: string) {\n    const { datasource } = this.state;\n    if (datasource.meta.id !== datasourceId) {\n      // Navigated away, queries did not matter\n      return;\n    }\n\n    console.error(response);\n\n    let error: string | JSX.Element = response;\n    if (response.data) {\n      error = response.data.error;\n      if (response.data.response) {\n        error = (\n          <>\n            <span>{response.data.error}</span>\n            <details>{response.data.response}</details>\n          </>\n        );\n      }\n    }\n\n    this.setState(state => {\n      // Transaction might have been discarded\n      if (!state.queryTransactions.find(qt => qt.id === transactionId)) {\n        return null;\n      }\n\n      // Mark transactions as complete\n      const nextQueryTransactions = state.queryTransactions.map(qt => {\n        if (qt.id === transactionId) {\n          return {\n            ...qt,\n            error,\n            done: true,\n          };\n        }\n        return qt;\n      });\n\n      return {\n        queryTransactions: nextQueryTransactions,\n      };\n    });\n  }\n\n  async runGraphQueries() {\n    const queries = [...this.queryExpressions];\n    if (!hasQuery(queries)) {\n      return;\n    }\n    const { datasource } = this.state;\n    const datasourceId = datasource.meta.id;\n    // Run all queries concurrently\n    queries.forEach(async (query, rowIndex) => {\n      if (query) {\n        const transaction = this.startQueryTransaction(query, rowIndex, 'Graph', {\n          format: 'time_series',\n          instant: false,\n        });\n        try {\n          const now = Date.now();\n          const res = await datasource.query(transaction.options);\n          const latency = Date.now() - now;\n          const results = makeTimeSeriesList(res.data, transaction.options);\n          this.completeQueryTransaction(transaction.id, results, latency, queries, datasourceId);\n          this.setState({ graphRange: transaction.options.range });\n        } catch (response) {\n          this.failQueryTransaction(transaction.id, response, datasourceId);\n        }\n      } else {\n        this.discardTransactions(rowIndex);\n      }\n    });\n  }\n\n  async runTableQuery() {\n    const queries = [...this.queryExpressions];\n    if (!hasQuery(queries)) {\n      return;\n    }\n    const { datasource } = this.state;\n    const datasourceId = datasource.meta.id;\n    // Run all queries concurrently\n    queries.forEach(async (query, rowIndex) => {\n      if (query) {\n        const transaction = this.startQueryTransaction(query, rowIndex, 'Table', {\n          format: 'table',\n          instant: true,\n          valueWithRefId: true,\n        });\n        try {\n          const now = Date.now();\n          const res = await datasource.query(transaction.options);\n          const latency = Date.now() - now;\n          const results = res.data[0];\n          this.completeQueryTransaction(transaction.id, results, latency, queries, datasourceId);\n        } catch (response) {\n          this.failQueryTransaction(transaction.id, response, datasourceId);\n        }\n      } else {\n        this.discardTransactions(rowIndex);\n      }\n    });\n  }\n\n  async runLogsQuery() {\n    const queries = [...this.queryExpressions];\n    if (!hasQuery(queries)) {\n      return;\n    }\n    const { datasource } = this.state;\n    const datasourceId = datasource.meta.id;\n    // Run all queries concurrently\n    queries.forEach(async (query, rowIndex) => {\n      if (query) {\n        const transaction = this.startQueryTransaction(query, rowIndex, 'Logs', { format: 'logs' });\n        try {\n          const now = Date.now();\n          const res = await datasource.query(transaction.options);\n          const latency = Date.now() - now;\n          const results = res.data;\n          this.completeQueryTransaction(transaction.id, results, latency, queries, datasourceId);\n        } catch (response) {\n          this.failQueryTransaction(transaction.id, response, datasourceId);\n        }\n      } else {\n        this.discardTransactions(rowIndex);\n      }\n    });\n  }\n\n  cloneState(): ExploreState {\n    // Copy state, but copy queries including modifications\n    return {\n      ...this.state,\n      queryTransactions: [],\n      queries: ensureQueries(this.queryExpressions.map(query => ({ query }))),\n    };\n  }\n\n  saveState = () => {\n    const { stateKey, onSaveState } = this.props;\n    onSaveState(stateKey, this.cloneState());\n  };\n\n  render() {\n    const { position, split } = this.props;\n    const {\n      StartPage,\n      datasource,\n      datasourceError,\n      datasourceLoading,\n      datasourceMissing,\n      exploreDatasources,\n      graphRange,\n      history,\n      queries,\n      queryTransactions,\n      range,\n      showingGraph,\n      showingLogs,\n      showingStartPage,\n      showingTable,\n      supportsGraph,\n      supportsLogs,\n      supportsTable,\n    } = this.state;\n    const graphHeight = showingGraph && showingTable ? '200px' : '400px';\n    const exploreClass = split ? 'explore explore-split' : 'explore';\n    const selectedDatasource = datasource ? exploreDatasources.find(d => d.label === datasource.name) : undefined;\n    const graphRangeIntervals = getIntervals(graphRange, datasource, this.el ? this.el.offsetWidth : 0);\n    const graphLoading = queryTransactions.some(qt => qt.resultType === 'Graph' && !qt.done);\n    const tableLoading = queryTransactions.some(qt => qt.resultType === 'Table' && !qt.done);\n    const logsLoading = queryTransactions.some(qt => qt.resultType === 'Logs' && !qt.done);\n    // TODO don't recreate those on each re-render\n    const graphResult = _.flatten(\n      queryTransactions.filter(qt => qt.resultType === 'Graph' && qt.done && qt.result).map(qt => qt.result)\n    );\n    const tableResult = mergeTablesIntoModel(\n      new TableModel(),\n      ...queryTransactions.filter(qt => qt.resultType === 'Table' && qt.done && qt.result).map(qt => qt.result)\n    );\n    const logsResult =\n      datasource && datasource.mergeStreams\n        ? datasource.mergeStreams(\n            _.flatten(\n              queryTransactions.filter(qt => qt.resultType === 'Logs' && qt.done && qt.result).map(qt => qt.result)\n            ),\n            graphRangeIntervals.intervalMs\n          )\n        : undefined;\n    const loading = queryTransactions.some(qt => !qt.done);\n\n    return (\n      <div className={exploreClass} ref={this.getRef}>\n        <div className=\"navbar\">\n          {position === 'left' ? (\n            <div>\n              <a className=\"navbar-page-btn\">\n                <i className=\"fa fa-rocket\" />\n                Explore\n              </a>\n            </div>\n          ) : (\n            <div className=\"navbar-buttons explore-first-button\">\n              <button className=\"btn navbar-button\" onClick={this.onClickCloseSplit}>\n                Close Split\n              </button>\n            </div>\n          )}\n          {!datasourceMissing ? (\n            <div className=\"navbar-buttons\">\n              <Select\n                classNamePrefix={`gf-form-select-box`}\n                isMulti={false}\n                isLoading={datasourceLoading}\n                isClearable={false}\n                className=\"gf-form-input gf-form-input--form-dropdown datasource-picker\"\n                onChange={this.onChangeDatasource}\n                options={exploreDatasources}\n                styles={ResetStyles}\n                placeholder=\"Select datasource\"\n                loadingMessage={() => 'Loading datasources...'}\n                noOptionsMessage={() => 'No datasources found'}\n                value={selectedDatasource}\n                components={{\n                  Option: PickerOption,\n                  IndicatorsContainer,\n                  NoOptionsMessage,\n                }}\n              />\n            </div>\n          ) : null}\n          <div className=\"navbar__spacer\" />\n          {position === 'left' && !split ? (\n            <div className=\"navbar-buttons\">\n              <button className=\"btn navbar-button\" onClick={this.onClickSplit}>\n                Split\n              </button>\n            </div>\n          ) : null}\n          <TimePicker range={range} onChangeTime={this.onChangeTime} />\n          <div className=\"navbar-buttons\">\n            <button className=\"btn navbar-button navbar-button--no-icon\" onClick={this.onClickClear}>\n              Clear All\n            </button>\n          </div>\n          <div className=\"navbar-buttons relative\">\n            <button className=\"btn navbar-button--primary\" onClick={this.onSubmit}>\n              Run Query{' '}\n              {loading ? <i className=\"fa fa-spinner fa-spin run-icon\" /> : <i className=\"fa fa-level-down run-icon\" />}\n            </button>\n          </div>\n        </div>\n\n        {datasourceLoading ? <div className=\"explore-container\">Loading datasource...</div> : null}\n\n        {datasourceMissing ? (\n          <div className=\"explore-container\">Please add a datasource that supports Explore (e.g., Prometheus).</div>\n        ) : null}\n\n        {datasourceError ? (\n          <div className=\"explore-container\">Error connecting to datasource. [{datasourceError}]</div>\n        ) : null}\n\n        {datasource && !datasourceError ? (\n          <div className=\"explore-container\">\n            <QueryRows\n              datasource={datasource}\n              history={history}\n              queries={queries}\n              onAddQueryRow={this.onAddQueryRow}\n              onChangeQuery={this.onChangeQuery}\n              onClickHintFix={this.onModifyQueries}\n              onExecuteQuery={this.onSubmit}\n              onRemoveQueryRow={this.onRemoveQueryRow}\n              transactions={queryTransactions}\n            />\n            <main className=\"m-t-2\">\n              <ErrorBoundary>\n                {showingStartPage && <StartPage onClickQuery={this.onClickQuery} />}\n                {!showingStartPage && (\n                  <>\n                    {supportsGraph && (\n                      <Panel\n                        label=\"Graph\"\n                        isOpen={showingGraph}\n                        loading={graphLoading}\n                        onToggle={this.onClickGraphButton}\n                      >\n                        <Graph\n                          data={graphResult}\n                          height={graphHeight}\n                          id={`explore-graph-${position}`}\n                          onChangeTime={this.onChangeTime}\n                          range={graphRange}\n                          split={split}\n                        />\n                      </Panel>\n                    )}\n                    {supportsTable && (\n                      <Panel\n                        label=\"Table\"\n                        loading={tableLoading}\n                        isOpen={showingTable}\n                        onToggle={this.onClickTableButton}\n                      >\n                        <Table data={tableResult} loading={tableLoading} onClickCell={this.onClickTableCell} />\n                      </Panel>\n                    )}\n                    {supportsLogs && (\n                      <Panel label=\"Logs\" loading={logsLoading} isOpen={showingLogs} onToggle={this.onClickLogsButton}>\n                        <Logs\n                          data={logsResult}\n                          loading={logsLoading}\n                          position={position}\n                          onChangeTime={this.onChangeTime}\n                          range={range}\n                        />\n                      </Panel>\n                    )}\n                  </>\n                )}\n              </ErrorBoundary>\n            </main>\n          </div>\n        ) : null}\n      </div>\n    );\n  }\n}\n\nexport default hot(module)(Explore);\n","import React, { PureComponent } from 'react';\n\ninterface Props {\n  isOpen: boolean;\n  label: string;\n  loading?: boolean;\n  onToggle: (isOpen: boolean) => void;\n}\n\nexport default class Panel extends PureComponent<Props> {\n  onClickToggle = () => this.props.onToggle(!this.props.isOpen);\n\n  render() {\n    const { isOpen, loading } = this.props;\n    const iconClass = isOpen ? 'fa fa-caret-up' : 'fa fa-caret-down';\n    const loaderClass = loading ? 'explore-panel__loader explore-panel__loader--active' : 'explore-panel__loader';\n    return (\n      <div className=\"explore-panel panel-container\">\n        <div className=\"explore-panel__header\" onClick={this.onClickToggle}>\n          <div className=\"explore-panel__header-buttons\">\n            <span className={iconClass} />\n          </div>\n          <div className=\"explore-panel__header-label\">{this.props.label}</div>\n        </div>\n        {isOpen && (\n          <div className=\"explore-panel__body\">\n            <div className={loaderClass} />\n            {this.props.children}\n          </div>\n        )}\n      </div>\n    );\n  }\n}\n","import _ from 'lodash';\nimport React, { PureComponent } from 'react';\nimport ReactTable from 'react-table';\n\nimport TableModel from 'app/core/table_model';\n\nconst EMPTY_TABLE = new TableModel();\n// Identify columns that contain values\nconst VALUE_REGEX = /^[Vv]alue #\\d+/;\n\ninterface TableProps {\n  data: TableModel;\n  loading: boolean;\n  onClickCell?: (columnKey: string, rowValue: string) => void;\n}\n\nfunction prepareRows(rows, columnNames) {\n  return rows.map(cells => _.zipObject(columnNames, cells));\n}\n\nexport default class Table extends PureComponent<TableProps> {\n  getCellProps = (state, rowInfo, column) => {\n    return {\n      onClick: (e: React.SyntheticEvent) => {\n        // Only handle click on link, not the cell\n        if (e.target) {\n          const link = e.target as HTMLElement;\n          if (link.className === 'link') {\n            const columnKey = column.Header;\n            const rowValue = rowInfo.row[columnKey];\n            this.props.onClickCell(columnKey, rowValue);\n          }\n        }\n      },\n    };\n  };\n\n  render() {\n    const { data, loading } = this.props;\n    const tableModel = data || EMPTY_TABLE;\n    const columnNames = tableModel.columns.map(({ text }) => text);\n    const columns = tableModel.columns.map(({ filterable, text }) => ({\n      Header: text,\n      accessor: text,\n      className: VALUE_REGEX.test(text) ? 'text-right' : '',\n      show: text !== 'Time',\n      Cell: row => <span className={filterable ? 'link' : ''}>{row.value}</span>,\n    }));\n    const noDataText = data ? 'The queries returned no data for a table.' : '';\n\n    return (\n      <ReactTable\n        columns={columns}\n        data={tableModel.rows}\n        getTdProps={this.getCellProps}\n        loading={loading}\n        minRows={0}\n        noDataText={noDataText}\n        resolveData={data => prepareRows(data, columnNames)}\n        showPagination={Boolean(data)}\n      />\n    );\n  }\n}\n","import React, { PureComponent } from 'react';\nimport moment from 'moment';\n\nimport * as dateMath from 'app/core/utils/datemath';\nimport * as rangeUtil from 'app/core/utils/rangeutil';\nimport { RawTimeRange } from 'app/types/series';\n\nconst DATE_FORMAT = 'YYYY-MM-DD HH:mm:ss';\nexport const DEFAULT_RANGE = {\n  from: 'now-6h',\n  to: 'now',\n};\n\n/**\n * Return a human-editable string of either relative (inludes \"now\") or absolute local time (in the shape of DATE_FORMAT).\n * @param value Epoch or relative time\n */\nexport function parseTime(value: string, isUtc = false): string {\n  if (moment.isMoment(value)) {\n    return value;\n  }\n  if (value.indexOf('now') !== -1) {\n    return value;\n  }\n  let time: any = value;\n  // Possible epoch\n  if (!isNaN(time)) {\n    time = parseInt(time, 10);\n  }\n  time = isUtc ? moment.utc(time) : moment(time);\n  return time.format(DATE_FORMAT);\n}\n\ninterface TimePickerProps {\n  isOpen?: boolean;\n  isUtc?: boolean;\n  range?: RawTimeRange;\n  onChangeTime?: (Range) => void;\n}\n\ninterface TimePickerState {\n  isOpen: boolean;\n  isUtc: boolean;\n  rangeString: string;\n  refreshInterval?: string;\n  initialRange?: RawTimeRange;\n\n  // Input-controlled text, keep these in a shape that is human-editable\n  fromRaw: string;\n  toRaw: string;\n}\n\nexport default class TimePicker extends PureComponent<TimePickerProps, TimePickerState> {\n  dropdownEl: any;\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      isOpen: props.isOpen,\n      isUtc: props.isUtc,\n      rangeString: '',\n      fromRaw: '',\n      toRaw: '',\n      initialRange: DEFAULT_RANGE,\n      refreshInterval: '',\n    };\n  }\n\n  static getDerivedStateFromProps(props, state) {\n    if (state.initialRange && state.initialRange === props.range) {\n      return state;\n    }\n\n    const from = props.range ? props.range.from : DEFAULT_RANGE.from;\n    const to = props.range ? props.range.to : DEFAULT_RANGE.to;\n\n    // Ensure internal format\n    const fromRaw = parseTime(from, props.isUtc);\n    const toRaw = parseTime(to, props.isUtc);\n    const range = {\n      from: fromRaw,\n      to: toRaw,\n    };\n\n    return {\n      ...state,\n      fromRaw,\n      toRaw,\n      initialRange: props.range,\n      rangeString: rangeUtil.describeTimeRange(range),\n    };\n  }\n\n  move(direction: number) {\n    const { onChangeTime } = this.props;\n    const { fromRaw, toRaw } = this.state;\n    const from = dateMath.parse(fromRaw, false);\n    const to = dateMath.parse(toRaw, true);\n    const timespan = (to.valueOf() - from.valueOf()) / 2;\n\n    let nextTo, nextFrom;\n    if (direction === -1) {\n      nextTo = to.valueOf() - timespan;\n      nextFrom = from.valueOf() - timespan;\n    } else if (direction === 1) {\n      nextTo = to.valueOf() + timespan;\n      nextFrom = from.valueOf() + timespan;\n      if (nextTo > Date.now() && to < Date.now()) {\n        nextTo = Date.now();\n        nextFrom = from.valueOf();\n      }\n    } else {\n      nextTo = to.valueOf();\n      nextFrom = from.valueOf();\n    }\n\n    const nextRange = {\n      from: moment(nextFrom),\n      to: moment(nextTo),\n    };\n\n    this.setState(\n      {\n        rangeString: rangeUtil.describeTimeRange(nextRange),\n        fromRaw: nextRange.from.format(DATE_FORMAT),\n        toRaw: nextRange.to.format(DATE_FORMAT),\n      },\n      () => {\n        onChangeTime(nextRange);\n      }\n    );\n  }\n\n  handleChangeFrom = e => {\n    this.setState({\n      fromRaw: e.target.value,\n    });\n  };\n\n  handleChangeTo = e => {\n    this.setState({\n      toRaw: e.target.value,\n    });\n  };\n\n  handleClickApply = () => {\n    const { onChangeTime } = this.props;\n    let range;\n    this.setState(\n      state => {\n        const { toRaw, fromRaw } = this.state;\n        range = {\n          from: dateMath.parse(fromRaw, false),\n          to: dateMath.parse(toRaw, true),\n        };\n        const rangeString = rangeUtil.describeTimeRange(range);\n        return {\n          isOpen: false,\n          rangeString,\n        };\n      },\n      () => {\n        if (onChangeTime) {\n          onChangeTime(range);\n        }\n      }\n    );\n  };\n\n  handleClickLeft = () => this.move(-1);\n  handleClickPicker = () => {\n    this.setState(state => ({\n      isOpen: !state.isOpen,\n    }));\n  };\n  handleClickRight = () => this.move(1);\n  handleClickRefresh = () => {};\n  handleClickRelativeOption = range => {\n    const { onChangeTime } = this.props;\n    const rangeString = rangeUtil.describeTimeRange(range);\n    this.setState(\n      {\n        toRaw: range.to,\n        fromRaw: range.from,\n        isOpen: false,\n        rangeString,\n      },\n      () => {\n        if (onChangeTime) {\n          onChangeTime(range);\n        }\n      }\n    );\n  };\n\n  getTimeOptions() {\n    return rangeUtil.getRelativeTimesList({}, this.state.rangeString);\n  }\n\n  dropdownRef = el => {\n    this.dropdownEl = el;\n  };\n\n  renderDropdown() {\n    const { fromRaw, isOpen, toRaw } = this.state;\n    if (!isOpen) {\n      return null;\n    }\n    const timeOptions = this.getTimeOptions();\n    return (\n      <div ref={this.dropdownRef} className=\"gf-timepicker-dropdown\">\n        <div className=\"gf-timepicker-absolute-section\">\n          <h3 className=\"section-heading\">Custom range</h3>\n\n          <label className=\"small\">From:</label>\n          <div className=\"gf-form-inline\">\n            <div className=\"gf-form max-width-28\">\n              <input\n                type=\"text\"\n                className=\"gf-form-input input-large timepicker-from\"\n                value={fromRaw}\n                onChange={this.handleChangeFrom}\n              />\n            </div>\n          </div>\n\n          <label className=\"small\">To:</label>\n          <div className=\"gf-form-inline\">\n            <div className=\"gf-form max-width-28\">\n              <input\n                type=\"text\"\n                className=\"gf-form-input input-large timepicker-to\"\n                value={toRaw}\n                onChange={this.handleChangeTo}\n              />\n            </div>\n          </div>\n\n          {/* <label className=\"small\">Refreshing every:</label>\n          <div className=\"gf-form-inline\">\n            <div className=\"gf-form max-width-28\">\n              <select className=\"gf-form-input input-medium\" ng-options=\"f.value as f.text for f in ctrl.refresh.options\"></select>\n            </div>\n          </div> */}\n          <div className=\"gf-form\">\n            <button className=\"btn gf-form-btn btn-secondary\" onClick={this.handleClickApply}>\n              Apply\n            </button>\n          </div>\n        </div>\n\n        <div className=\"gf-timepicker-relative-section\">\n          <h3 className=\"section-heading\">Quick ranges</h3>\n          {Object.keys(timeOptions).map(section => {\n            const group = timeOptions[section];\n            return (\n              <ul key={section}>\n                {group.map(option => (\n                  <li className={option.active ? 'active' : ''} key={option.display}>\n                    <a onClick={() => this.handleClickRelativeOption(option)}>{option.display}</a>\n                  </li>\n                ))}\n              </ul>\n            );\n          })}\n        </div>\n      </div>\n    );\n  }\n\n  render() {\n    const { isUtc, rangeString, refreshInterval } = this.state;\n    return (\n      <div className=\"timepicker\">\n        <div className=\"navbar-buttons\">\n          <button className=\"btn navbar-button navbar-button--tight timepicker-left\" onClick={this.handleClickLeft}>\n            <i className=\"fa fa-chevron-left\" />\n          </button>\n          <button className=\"btn navbar-button gf-timepicker-nav-btn\" onClick={this.handleClickPicker}>\n            <i className=\"fa fa-clock-o\" />\n            <span className=\"timepicker-rangestring\">{rangeString}</span>\n            {isUtc ? <span className=\"gf-timepicker-utc\">UTC</span> : null}\n            {refreshInterval ? <span className=\"text-warning\">&nbsp; Refresh every {refreshInterval}</span> : null}\n          </button>\n          <button className=\"btn navbar-button navbar-button--tight timepicker-right\" onClick={this.handleClickRight}>\n            <i className=\"fa fa-chevron-right\" />\n          </button>\n        </div>\n        {this.renderDropdown()}\n      </div>\n    );\n  }\n}\n","import { Query } from 'app/types/explore';\n\nexport function generateQueryKey(index = 0): string {\n  return `Q-${Date.now()}-${Math.random()}-${index}`;\n}\n\nexport function ensureQueries(queries?: Query[]): Query[] {\n  if (queries && typeof queries === 'object' && queries.length > 0 && typeof queries[0].query === 'string') {\n    return queries.map(({ query }, i) => ({ key: generateQueryKey(i), query }));\n  }\n  return [{ key: generateQueryKey(), query: '' }];\n}\n\nexport function hasQuery(queries: string[]): boolean {\n  return queries.some(q => Boolean(q));\n}\n","import React, { PureComponent } from 'react';\n\nconst INTERVAL = 150;\n\nexport default class ElapsedTime extends PureComponent<any, any> {\n  offset: number;\n  timer: number;\n\n  state = {\n    elapsed: 0,\n  };\n\n  start() {\n    this.offset = Date.now();\n    this.timer = window.setInterval(this.tick, INTERVAL);\n  }\n\n  tick = () => {\n    const jetzt = Date.now();\n    const elapsed = jetzt - this.offset;\n    this.setState({ elapsed });\n  };\n\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.time) {\n      clearInterval(this.timer);\n    } else if (this.props.time) {\n      this.start();\n    }\n  }\n\n  componentDidMount() {\n    this.start();\n  }\n\n  componentWillUnmount() {\n    clearInterval(this.timer);\n  }\n\n  render() {\n    const { elapsed } = this.state;\n    const { className, time } = this.props;\n    const value = (time || elapsed) / 1000;\n    return <span className={`elapsed-time ${className}`}>{value.toFixed(1)}s</span>;\n  }\n}\n","import React, { PureComponent } from 'react';\n\nimport { QueryTransaction } from 'app/types/explore';\nimport ElapsedTime from './ElapsedTime';\n\nfunction formatLatency(value) {\n  return `${(value / 1000).toFixed(1)}s`;\n}\n\ninterface QueryTransactionStatusItemProps {\n  transaction: QueryTransaction;\n}\n\nclass QueryTransactionStatusItem extends PureComponent<QueryTransactionStatusItemProps> {\n  render() {\n    const { transaction } = this.props;\n    const className = transaction.done ? 'query-transaction' : 'query-transaction query-transaction--loading';\n    return (\n      <div className={className}>\n        <div className=\"query-transaction__type\">{transaction.resultType}:</div>\n        <div className=\"query-transaction__duration\">\n          {transaction.done ? formatLatency(transaction.latency) : <ElapsedTime />}\n        </div>\n      </div>\n    );\n  }\n}\n\ninterface QueryTransactionStatusProps {\n  transactions: QueryTransaction[];\n}\n\nexport default class QueryTransactionStatus extends PureComponent<QueryTransactionStatusProps> {\n  render() {\n    const { transactions } = this.props;\n    return (\n      <div className=\"query-transactions\">\n        {transactions.map((t, i) => <QueryTransactionStatusItem key={`${t.query}:${t.resultType}`} transaction={t} />)}\n      </div>\n    );\n  }\n}\n","import React, { PureComponent } from 'react';\n\nimport { QueryTransaction, HistoryItem, Query, QueryHint } from 'app/types/explore';\n\nimport DefaultQueryField from './QueryField';\nimport QueryTransactionStatus from './QueryTransactionStatus';\nimport { DataSource } from 'app/types';\n\nfunction getFirstHintFromTransactions(transactions: QueryTransaction[]): QueryHint {\n  const transaction = transactions.find(qt => qt.hints && qt.hints.length > 0);\n  if (transaction) {\n    return transaction.hints[0];\n  }\n  return undefined;\n}\n\ninterface QueryRowEventHandlers {\n  onAddQueryRow: (index: number) => void;\n  onChangeQuery: (value: string, index: number, override?: boolean) => void;\n  onClickHintFix: (action: object, index?: number) => void;\n  onExecuteQuery: () => void;\n  onRemoveQueryRow: (index: number) => void;\n}\n\ninterface QueryRowCommonProps {\n  className?: string;\n  datasource: DataSource;\n  history: HistoryItem[];\n  transactions: QueryTransaction[];\n}\n\ntype QueryRowProps = QueryRowCommonProps &\n  QueryRowEventHandlers & {\n    index: number;\n    query: string;\n  };\n\nclass QueryRow extends PureComponent<QueryRowProps> {\n  onChangeQuery = (value, override?: boolean) => {\n    const { index, onChangeQuery } = this.props;\n    if (onChangeQuery) {\n      onChangeQuery(value, index, override);\n    }\n  };\n\n  onClickAddButton = () => {\n    const { index, onAddQueryRow } = this.props;\n    if (onAddQueryRow) {\n      onAddQueryRow(index);\n    }\n  };\n\n  onClickClearButton = () => {\n    this.onChangeQuery('', true);\n  };\n\n  onClickHintFix = action => {\n    const { index, onClickHintFix } = this.props;\n    if (onClickHintFix) {\n      onClickHintFix(action, index);\n    }\n  };\n\n  onClickRemoveButton = () => {\n    const { index, onRemoveQueryRow } = this.props;\n    if (onRemoveQueryRow) {\n      onRemoveQueryRow(index);\n    }\n  };\n\n  onPressEnter = () => {\n    const { onExecuteQuery } = this.props;\n    if (onExecuteQuery) {\n      onExecuteQuery();\n    }\n  };\n\n  render() {\n    const { datasource, history, query, transactions } = this.props;\n    const transactionWithError = transactions.find(t => t.error !== undefined);\n    const hint = getFirstHintFromTransactions(transactions);\n    const queryError = transactionWithError ? transactionWithError.error : null;\n    const QueryField = datasource.pluginExports.ExploreQueryField || DefaultQueryField;\n    return (\n      <div className=\"query-row\">\n        <div className=\"query-row-status\">\n          <QueryTransactionStatus transactions={transactions} />\n        </div>\n        <div className=\"query-row-field\">\n          <QueryField\n            datasource={datasource}\n            error={queryError}\n            hint={hint}\n            initialQuery={query}\n            history={history}\n            onClickHintFix={this.onClickHintFix}\n            onPressEnter={this.onPressEnter}\n            onQueryChange={this.onChangeQuery}\n          />\n        </div>\n        <div className=\"query-row-tools\">\n          <button className=\"btn navbar-button navbar-button--tight\" onClick={this.onClickClearButton}>\n            <i className=\"fa fa-times\" />\n          </button>\n          <button className=\"btn navbar-button navbar-button--tight\" onClick={this.onClickAddButton}>\n            <i className=\"fa fa-plus\" />\n          </button>\n          <button className=\"btn navbar-button navbar-button--tight\" onClick={this.onClickRemoveButton}>\n            <i className=\"fa fa-minus\" />\n          </button>\n        </div>\n      </div>\n    );\n  }\n}\n\ntype QueryRowsProps = QueryRowCommonProps &\n  QueryRowEventHandlers & {\n    queries: Query[];\n  };\n\nexport default class QueryRows extends PureComponent<QueryRowsProps> {\n  render() {\n    const { className = '', queries, transactions, ...handlers } = this.props;\n    return (\n      <div className={className}>\n        {queries.map((q, index) => (\n          <QueryRow\n            key={q.key}\n            index={index}\n            query={q.query}\n            transactions={transactions.filter(t => t.rowIndex === index)}\n            {...handlers}\n          />\n        ))}\n      </div>\n    );\n  }\n}\n","import { TextMatch } from 'app/types/explore';\n\n/**\n * Adapt findMatchesInText for react-highlight-words findChunks handler.\n * See https://github.com/bvaughn/react-highlight-words#props\n */\nexport function findHighlightChunksInText({ searchWords, textToHighlight }) {\n  return findMatchesInText(textToHighlight, searchWords.join(' '));\n}\n\n/**\n * Returns a list of substring regexp matches.\n */\nexport function findMatchesInText(haystack: string, needle: string): TextMatch[] {\n  // Empty search can send re.exec() into infinite loop, exit early\n  if (!haystack || !needle) {\n    return [];\n  }\n  const regexp = new RegExp(`(?:${needle})`, 'g');\n  const matches = [];\n  let match = regexp.exec(haystack);\n  while (match) {\n    matches.push({\n      text: match[0],\n      start: match.index,\n      length: match[0].length,\n      end: match.index + match[0].length,\n    });\n    match = regexp.exec(haystack);\n  }\n  return matches;\n}\n","import React, { Fragment, PureComponent } from 'react';\nimport Highlighter from 'react-highlight-words';\n\nimport { RawTimeRange } from 'app/types/series';\nimport { LogsDedupStrategy, LogsModel, dedupLogRows } from 'app/core/logs_model';\nimport { findHighlightChunksInText } from 'app/core/utils/text';\nimport { Switch } from 'app/core/components/Switch/Switch';\n\nimport Graph from './Graph';\n\nconst graphOptions = {\n  series: {\n    bars: {\n      show: true,\n      lineWidth: 5,\n      // barWidth: 10,\n    },\n    // stack: true,\n  },\n  yaxis: {\n    tickDecimals: 0,\n  },\n};\n\ninterface LogsProps {\n  className?: string;\n  data: LogsModel;\n  loading: boolean;\n  position: string;\n  range?: RawTimeRange;\n  onChangeTime?: (range: RawTimeRange) => void;\n}\n\ninterface LogsState {\n  dedup: LogsDedupStrategy;\n  showLabels: boolean;\n  showLocalTime: boolean;\n  showUtc: boolean;\n}\n\nexport default class Logs extends PureComponent<LogsProps, LogsState> {\n  state = {\n    dedup: LogsDedupStrategy.none,\n    showLabels: true,\n    showLocalTime: true,\n    showUtc: false,\n  };\n\n  onChangeDedup = (dedup: LogsDedupStrategy) => {\n    this.setState(prevState => {\n      if (prevState.dedup === dedup) {\n        return { dedup: LogsDedupStrategy.none };\n      }\n      return { dedup };\n    });\n  };\n\n  onChangeLabels = (event: React.SyntheticEvent) => {\n    const target = event.target as HTMLInputElement;\n    this.setState({\n      showLabels: target.checked,\n    });\n  };\n\n  onChangeLocalTime = (event: React.SyntheticEvent) => {\n    const target = event.target as HTMLInputElement;\n    this.setState({\n      showLocalTime: target.checked,\n    });\n  };\n\n  onChangeUtc = (event: React.SyntheticEvent) => {\n    const target = event.target as HTMLInputElement;\n    this.setState({\n      showUtc: target.checked,\n    });\n  };\n\n  render() {\n    const { className = '', data, loading = false, position, range } = this.props;\n    const { dedup, showLabels, showLocalTime, showUtc } = this.state;\n    const hasData = data && data.rows && data.rows.length > 0;\n    const dedupedData = dedupLogRows(data, dedup);\n    const dedupCount = dedupedData.rows.reduce((sum, row) => sum + row.duplicates, 0);\n    const meta = [...data.meta];\n    if (dedup !== LogsDedupStrategy.none) {\n      meta.push({\n        label: 'Dedup count',\n        value: String(dedupCount),\n      });\n    }\n    const cssColumnSizes = ['3px']; // Log-level indicator line\n    if (showUtc) {\n      cssColumnSizes.push('minmax(100px, max-content)');\n    }\n    if (showLocalTime) {\n      cssColumnSizes.push('minmax(100px, max-content)');\n    }\n    if (showLabels) {\n      cssColumnSizes.push('minmax(100px, 25%)');\n    }\n    cssColumnSizes.push('1fr');\n    const logEntriesStyle = {\n      gridTemplateColumns: cssColumnSizes.join(' '),\n    };\n\n    return (\n      <div className={`${className} logs`}>\n        <div className=\"logs-graph\">\n          <Graph\n            data={data.series}\n            height=\"100px\"\n            range={range}\n            id={`explore-logs-graph-${position}`}\n            onChangeTime={this.props.onChangeTime}\n            userOptions={graphOptions}\n          />\n        </div>\n\n        <div className=\"logs-options\">\n          <div className=\"logs-controls\">\n            <Switch label=\"Timestamp\" checked={showUtc} onChange={this.onChangeUtc} small />\n            <Switch label=\"Local time\" checked={showLocalTime} onChange={this.onChangeLocalTime} small />\n            <Switch label=\"Labels\" checked={showLabels} onChange={this.onChangeLabels} small />\n            <Switch\n              label=\"Dedup: off\"\n              checked={dedup === LogsDedupStrategy.none}\n              onChange={() => this.onChangeDedup(LogsDedupStrategy.none)}\n              small\n            />\n            <Switch\n              label=\"Dedup: exact\"\n              checked={dedup === LogsDedupStrategy.exact}\n              onChange={() => this.onChangeDedup(LogsDedupStrategy.exact)}\n              small\n            />\n            <Switch\n              label=\"Dedup: numbers\"\n              checked={dedup === LogsDedupStrategy.numbers}\n              onChange={() => this.onChangeDedup(LogsDedupStrategy.numbers)}\n              small\n            />\n            <Switch\n              label=\"Dedup: signature\"\n              checked={dedup === LogsDedupStrategy.signature}\n              onChange={() => this.onChangeDedup(LogsDedupStrategy.signature)}\n              small\n            />\n            {hasData &&\n              meta && (\n                <div className=\"logs-meta\">\n                  {meta.map(item => (\n                    <div className=\"logs-meta-item\" key={item.label}>\n                      <span className=\"logs-meta-item__label\">{item.label}:</span>\n                      <span className=\"logs-meta-item__value\">{item.value}</span>\n                    </div>\n                  ))}\n                </div>\n              )}\n          </div>\n        </div>\n\n        <div className=\"logs-entries\" style={logEntriesStyle}>\n          {hasData &&\n            dedupedData.rows.map(row => (\n              <Fragment key={row.key}>\n                <div className={row.logLevel ? `logs-row-level logs-row-level-${row.logLevel}` : ''}>\n                  {row.duplicates > 0 && (\n                    <div className=\"logs-row-level__duplicates\" title={`${row.duplicates} duplicates`}>\n                      {Array.apply(null, { length: row.duplicates }).map(index => (\n                        <div className=\"logs-row-level__duplicate\" key={`${index}`} />\n                      ))}\n                    </div>\n                  )}\n                </div>\n                {showUtc && <div title={`Local: ${row.timeLocal} (${row.timeFromNow})`}>{row.timestamp}</div>}\n                {showLocalTime && <div title={`${row.timestamp} (${row.timeFromNow})`}>{row.timeLocal}</div>}\n                {showLabels && (\n                  <div className=\"max-width\" title={row.labels}>\n                    {row.labels}\n                  </div>\n                )}\n                <div>\n                  <Highlighter\n                    textToHighlight={row.entry}\n                    searchWords={row.searchWords}\n                    findChunks={findHighlightChunksInText}\n                    highlightClassName=\"logs-row-match-highlight\"\n                  />\n                </div>\n              </Fragment>\n            ))}\n        </div>\n        {!loading && !hasData && 'No data was returned.'}\n      </div>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport { hot } from 'react-hot-loader';\nimport { connect } from 'react-redux';\n\nimport { updateLocation } from 'app/core/actions';\nimport { serializeStateToUrlParam, parseUrlState } from 'app/core/utils/explore';\nimport { StoreState } from 'app/types';\nimport { ExploreState } from 'app/types/explore';\n\nimport ErrorBoundary from './ErrorBoundary';\nimport Explore from './Explore';\n\ninterface WrapperProps {\n  backendSrv?: any;\n  datasourceSrv?: any;\n  updateLocation: typeof updateLocation;\n  urlStates: { [key: string]: string };\n}\n\ninterface WrapperState {\n  split: boolean;\n  splitState: ExploreState;\n}\n\nconst STATE_KEY_LEFT = 'state';\nconst STATE_KEY_RIGHT = 'stateRight';\n\nexport class Wrapper extends Component<WrapperProps, WrapperState> {\n  urlStates: { [key: string]: string };\n\n  constructor(props: WrapperProps) {\n    super(props);\n    this.urlStates = props.urlStates;\n    this.state = {\n      split: Boolean(props.urlStates[STATE_KEY_RIGHT]),\n      splitState: undefined,\n    };\n  }\n\n  onChangeSplit = (split: boolean, splitState: ExploreState) => {\n    this.setState({ split, splitState });\n    // When closing split, remove URL state for split part\n    if (!split) {\n      delete this.urlStates[STATE_KEY_RIGHT];\n      this.props.updateLocation({\n        query: this.urlStates,\n      });\n    }\n  };\n\n  onSaveState = (key: string, state: ExploreState) => {\n    const urlState = serializeStateToUrlParam(state, true);\n    this.urlStates[key] = urlState;\n    this.props.updateLocation({\n      query: this.urlStates,\n    });\n  };\n\n  render() {\n    const { datasourceSrv } = this.props;\n    // State overrides for props from first Explore\n    const { split, splitState } = this.state;\n    const urlStateLeft = parseUrlState(this.urlStates[STATE_KEY_LEFT]);\n    const urlStateRight = parseUrlState(this.urlStates[STATE_KEY_RIGHT]);\n\n    return (\n      <div className=\"explore-wrapper\">\n        <ErrorBoundary>\n          <Explore\n            datasourceSrv={datasourceSrv}\n            onChangeSplit={this.onChangeSplit}\n            onSaveState={this.onSaveState}\n            position=\"left\"\n            split={split}\n            stateKey={STATE_KEY_LEFT}\n            urlState={urlStateLeft}\n          />\n        </ErrorBoundary>\n        {split && (\n          <ErrorBoundary>\n            <Explore\n              datasourceSrv={datasourceSrv}\n              onChangeSplit={this.onChangeSplit}\n              onSaveState={this.onSaveState}\n              position=\"right\"\n              split={split}\n              splitState={splitState}\n              stateKey={STATE_KEY_RIGHT}\n              urlState={urlStateRight}\n            />\n          </ErrorBoundary>\n        )}\n      </div>\n    );\n  }\n}\n\nconst mapStateToProps = (state: StoreState) => ({\n  urlStates: state.location.query,\n});\n\nconst mapDispatchToProps = {\n  updateLocation,\n};\n\nexport default hot(module)(connect(mapStateToProps, mapDispatchToProps)(Wrapper));\n"],"sourceRoot":""}